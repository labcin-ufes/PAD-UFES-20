<div class="card" *ngIf="!cropando">

    <div class="card-header">
        <i class="fa fa-scissors"></i>
        <strong> Auditando lesão dermaro </strong>        
    </div> 

    <div class="card-body">
        <!-- FORM INSERÇÃO DA LESÃO -->
        <form
        #dadosLesao="ngForm" 
        (ngSubmit)="salvarAuditoria()"
        >
            <!-- TOPO COM SWITCH E BOTAO VOLTAR -->
            <div class="row">

                <div class="col-3">
                        <button
                        type="button"
                        class="btn btn-info"
                        (click)="cancelarAuditoria()"
                    >
                    <i class="fa fa-arrow-left"></i>
                    Voltar
                    
                    </button>
                </div>

                <div class="col-7"></div>
                
                <div class="col-2">
                    <label for="auditado"> <strong> Auditado? </strong> </label>
                    <div>
                        <label class="switch switch-label switch-primary">
                            <input 
                                type="checkbox" 
                                class="switch-input"                                                 
                                ngModel
                                [ngModel]="false"
                                name="auditado"
                            >
                            <span 
                                class="switch-slider" 
                                data-checked="Sim" 
                                data-unchecked="Não">
                            </span>
                        </label>
                    </div>
                </div>

            </div>
            <!-- TOPO COM SWITCH E BOTAO VOLTAR -->

            <!-- LINHA 1 DO FORM DE LESAO -->
            <div class="row">

                <!-- DIAGNOSTICO CLINICO -->
                <div class="form-group col-sm-4">
                    <label for="diagCli">Diagnóstico clínico*: </label>
                    <div>
                        <input 
                            type="text" 
                            id="diagCli"
                            class="form-control"                                        
                            ngModel
                            name="diagnostico"
                            #diagCli="ngModel"
                            [ngModel]="lesao.diagnostico"
                            [ngbTypeahead]="completarDiagnostico"  
                            minlength="3"
                            required                                   
                        >
                        <small 
                            *ngIf="diagCli.invalid && diagCli.touched" 
                            class="form-text text-danger">
                                Diagnóstico clínico é obrigatório
                        </small>
                    </div>
                </div>
                <!-- DIAGNOSTICO CLINICO -->

                <!-- DIAGNOSTICO SECUNDARIO -->
                <div class="form-group col-sm-4">
                    <label for="diagCli2">Diagnóstico clínico secundário: </label>
                    <div>
                        <input 
                            type="text" 
                            id="diagCli2"
                            class="form-control"                                        
                            ngModel
                            [ngModel]="lesao.diagnosticoSecundario"
                            name="diagnosticoSecundario"
                            minlength="3"
                            [ngbTypeahead]="completarDiagnostico"                                                                               
                        >                                
                    </div>
                </div>
                <!-- DIAGNOSTICO SECUNDARIO -->

                <!-- REGIAO -->
                <div class="form-group col-sm-4">
                    <label for="regiao">Região da lesão*: </label>
                    <div>
                        <input 
                            type="text" 
                            id="regiao"
                            class="form-control"                                        
                            ngModel
                            [ngModel]="lesao.regiao"
                            name="regiao"
                            #regiao="ngModel"
                            [ngbTypeahead]="completarRegiao"
                            (change)="buscaGrandeRegiao(this.dadosLesao.value.regiao)"
                            minlength="2"
                            required                                                                            
                        >                                
                    </div>
                    <small 
                        *ngIf="regiao.invalid && regiao.touched" 
                        class="form-text text-danger">
                            Região da lesão obrigatório
                    </small>
                </div>
                <!-- REGIAO -->                                
                    
            </div>
            <!-- LINHA 1 DO FORM DE LESAO -->     
            
            <!-- LINHA 2 DO FORM DE LESAO -->
            <div class="row">

                <!-- CRESCEU -->
                <div class="form-group col-sm-2">
                    <label for="cresceu">Creceu? </label>
                    <div>
                        <label class="switch switch-label switch-primary">
                            <input 
                                type="checkbox" 
                                class="switch-input"                                                 
                                ngModel
                                [ngModel]="lesao.cresceu"
                                name="cresceu"
                            >
                            <span 
                                class="switch-slider" 
                                data-checked="Sim" 
                                data-unchecked="Não">
                            </span>
                        </label>                              
                    </div>
                </div>
                <!-- CRESCEU -->

                <!-- COÇOU -->
                <div class="form-group col-sm-2">
                    <label for="cocou">Coçou? </label>
                    <div>
                        <label class="switch switch-label switch-primary">
                            <input 
                                type="checkbox" 
                                class="switch-input"                                                 
                                ngModel
                                [ngModel]="lesao.cocou"
                                name="cocou"
                            >
                            <span 
                                class="switch-slider" 
                                data-checked="Sim" 
                                data-unchecked="Não">
                            </span>
                        </label>                              
                    </div>
                </div>
                <!-- COÇOU -->  
                
                <!-- SANGROU -->
                <div class="form-group col-sm-2">
                    <label for="sangrou">Sangrou? </label>
                    <div>
                        <label class="switch switch-label switch-primary">
                            <input 
                                type="checkbox" 
                                class="switch-input"                                                 
                                ngModel
                                [ngModel]="lesao.sangrou"
                                name="sangrou"
                            >
                            <span 
                                class="switch-slider" 
                                data-checked="Sim" 
                                data-unchecked="Não">
                            </span>
                        </label>                              
                    </div>
                </div>
                <!-- SANGROU -->      
                
                <!-- DOEU -->
                <div class="form-group col-sm-2">
                    <label for="doeu">Doeu? </label>
                    <div>
                        <label class="switch switch-label switch-primary">
                            <input 
                                type="checkbox" 
                                class="switch-input"                                                 
                                ngModel
                                [ngModel]="lesao.doeu"
                                name="doeu"
                            >
                            <span 
                                class="switch-slider" 
                                data-checked="Sim" 
                                data-unchecked="Não">
                            </span>
                        </label>                              
                    </div>
                </div>
                <!-- DOEU --> 
                
                <!-- MUDOU PADRAO -->
                <div class="form-group col-sm-2">
                    <label for="mudou">Mudou padrão? </label>
                    <div>
                        <label class="switch switch-label switch-primary">
                            <input 
                                type="checkbox" 
                                class="switch-input"                                                 
                                ngModel
                                [ngModel]="lesao.mudou"
                                name="mudou"
                            >
                            <span 
                                class="switch-slider" 
                                data-checked="Sim" 
                                data-unchecked="Não">
                            </span>
                        </label>                              
                    </div>
                </div>
                <!-- MUDOU PADRAO -->

                <!-- RELEVO -->
                <div class="form-group col-sm-2">
                    <label for="relevo">Em relevo? </label>
                    <div>
                        <label class="switch switch-label switch-primary">
                            <input 
                                type="checkbox" 
                                class="switch-input"                                                 
                                ngModel
                                [ngModel]="lesao.relevo"
                                name="relevo"
                            >
                            <span 
                                class="switch-slider" 
                                data-checked="Sim" 
                                data-unchecked="Não">
                            </span>
                        </label>                              
                    </div>
                </div>
                <!-- RELEVO -->                                
                
            </div>
            <!-- LINHA 2 DO FORM DE LESAO -->
            
            <!-- LINHA 3 DO FORM DE LESAO -->
            <div class="row">

                <!-- REGIAO -->
                <div class="form-group col-sm-3">
                    <label for="idade">Idade do paciente*: </label>
                    <div>
                        <input 
                            type="number" 
                            id="idade"
                            class="form-control"                                        
                            ngModel
                            [ngModel]="lesao.idade"
                            name="idade"
                            #idade="ngModel"
                            required                                                                            
                        >                                
                    </div>
                    <small 
                        *ngIf="idade.invalid && idade.touched" 
                        class="form-text text-danger">
                            Idade do paciente obrigatório
                    </small>
                </div>
                <!-- REGIAO --> 

                <!-- OBSERVACAO -->
                <div class="form-grup col-sm-5">
                    <label for="obs">Observação: </label>
                    <div>
                        <input 
                            type="text" 
                            id="obs"
                            class="form-control"                                        
                            ngModel
                            [ngModel]="lesao.obs"
                            name="obs"                                                                                                                     
                        >                                
                    </div> 
                </div>
                <!-- OBSERVACAO -->    
                
                <!-- REGIAO -->
                <div class="form-group col-sm-4">
                    <label for="regiao">Grande região: </label>
                    <div>
                        <input 
                            type="text" 
                            id="grandeRegiao"
                            class="form-control"                                        
                            ngModel
                            [ngModel]="lesao.grandeRegiao"
                            name="grandeRegiao" 
                            #grandeRegiao="ngModel"                                                                                          
                        >                                
                    </div>
                    <small 
                        *ngIf="grandeRegiao.value === 'NÃO ENCONTRADO' || grandeRegiao.value === '' || grandeRegiao.value === 'NULL'"
                        class="form-text text-danger">
                            Grande região não encontrada!
                    </small>
                </div>
                <!-- REGIAO -->


            </div>
            <!-- LINHA 3 DO FORM DE LESAO -->

            <!-- IMAGENS DA LESAO -->
            <div class="row" *ngIf="imagens !== undefined" style="margin-top: 25px;">

                <div class="col-12 alert alert-warning text-center" *ngIf="imagens.length <= 0">
                    <strong> A lesão não possui imagens cadastradas </strong>
                </div>

                <div class="col">

                    <div class="card" *ngIf="imagens.length > 0">
                        
                        <div class="card-header">
                            <i class="fa fa-image"></i>
                            <strong> Imagens </strong>
                        </div>

                        <div class="card-body">

                            <div class="row">
                                <div class="col-4" *ngFor="let imagem of imagens">
                                    <div class="card">
                                            <a href="{{url_api}}/api/imagem/baixar?nomeImg={{imagem.path}}&tipo=dermato" target="_blank">
                                                <img src="{{url_api}}/api/imagem/baixar?nomeImg={{imagem.path}}&tipo=dermato&largura=250&altura=250"
                                                alt="Lesão"
                                                class="card-img-top">
                                            </a>

                                            <div class="card-body" style="padding: 30px;">

                                                <div class="row">
                                                    <h6 class="card-title"> <strong> Path:</strong> <small> {{imagem.path}} </small></h6>  
                                                </div>
                                                
                                                <div class="row float-right">

                                                    <div>

                                                        <button
                                                            type="button"
                                                            class="btn btn-info"
                                                            (click)="setarCropando(imagem)"
                                                        >
                                                            Cropar
                                                            <i class="fa fa-scissors"></i>
                                                        </button>

                                                    </div>

                                                    <div style="margin-left: 10px;">

                                                        <!-- EXCLUSÃO DE IMAGEM -->
                                                        <div 
                                                            class="btn-group" 
                                                            dropdown 
                                                            #dropdown="bs-dropdown"
                                                            [autoClose]="true" 
                                                            [insideClick]="true"
                                                        >

                                                            <button 
                                                                id="button-basic" 
                                                                dropdownToggle 
                                                                type="button" 
                                                                class="btn btn-danger dropdown-toggle"
                                                                aria-controls="dropdown-basic"
                                                            >
                                                                Excluir
                                                                <i class="fa fa-trash"></i>
                                                            </button>

                                                                <div id="dropdown-basic" *dropdownMenu class="dropdown-menu"
                                                                    role="menu" aria-labelledby="button-basic">

                                                                    <div class="px-4 py-3">
                                                                    
                                                                        <div class="form-group">

                                                                            <label for="apagar">Tem certeza que deseja excluir a imagem?</label>
                                                                            <button 
                                                                                type="button" 
                                                                                id="apagar"
                                                                                class="btn btn-success"
                                                                                (click)="excluirImagem(imagem)"
                                                                            >
                                                                                Sim
                                                                            </button>

                                                                            <button 
                                                                                type="button" 
                                                                                class="btn btn-danger"
                                                                                (click)="dropdown.hide()"
                                                                            >
                                                                                Não
                                                                            </button>
                                                                        </div>
                                                                        
                                                                    </div>
                                                                    
                                                                </div>
                                                        </div>
                                                        <!-- EXCLUSÃO DE IMAGEM -->

                                                    </div>

                                                </div>

                                            </div>
                                    </div>
                                </div>
                            </div>

                                

                        </div>

                    </div>

                </div>

            </div>
            <!-- IMAGENS DA LESAO -->


            <!-- BOTAO DE ENVIO -->
            <div class="form-group float-right" style="margin-top: 15px;">
                <button
                    type="submit"
                    [disabled]="dadosLesao.invalid"
                    class="btn btn-success btn-lg"
                >
                Salvar
                <i class="fa fa-check"></i>
                </button>

                <button
                    type="button"
                    class="btn btn-danger btn-lg"
                    style="margin-left: 5px;"
                    (click)="modalExcluir.show()"
                >
                Excluir lesão
                <i class="fa fa-trash"></i>
                </button>
                
            </div>
            <!-- BOTAO DE ENVIO -->                            


        </form>

    </div>

    <!-- MODAL EXCLUIR LESAO -->
    <div bsModal #modalExcluir="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">

                <div class="modal-header">
                    <h4 class="modal-title"> Tem certeza que deseja excluir a lesão? </h4>
                    <button type="button" class="close" (click)="modalExcluir.hide()" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    </button>
                </div>

            <div class="modal-body" style="padding: 35px;">

                <div class="row float-right" >
                    <button
                        type="button"
                        class="btn btn-success"
                        (click)="excluirLesao()"
                    >
                        Sim
                        <i class="fa fa-check"></i>
                    </button>

                    <button
                        style="margin-left: 15px;"
                        type="button"
                        class="btn btn-danger"
                        (click)="modalExcluir.hide()"
                    >
                        Não
                        <i class="fa fa-close"></i>
                    </button>
                </div>
                
            </div>

            </div>
        </div>
    </div>
    <!-- MODAL EXCLUIR LESAO -->

</div>


<!-- EDICAO DAS IMAGENS -->

<app-auditoria-edicao-imagem
    *ngIf="cropando"
    [urlLesao]="lesao._links.self.href"
    [imgParaCrop]="imgParaCrop"
    [tipoPac]="'dermato'"
    (eventoImagemCropada)="pegaEventoImagemCropada($event)"
>
    
</app-auditoria-edicao-imagem>

<!-- EDICAO DAS IMAGENS -->
